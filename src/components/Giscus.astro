---
interface Props {
  giscusId: string
  giscusCategory: string
  giscusCategoryId: string
}

const {
  giscusId,
  giscusCategory,
  giscusCategoryId
} = Astro.props

const locale = Astro.currentLocale as string;

// ê°œë°œ í™˜ê²½ ê°ì§€
const isDev = import.meta.env.DEV;
---

<!-- {!isDev && ( -->
  <giscus-widget
    is:inline
    id={giscusId}
    repo="yeonjulee1005/dewdew-world"
    repoid="R_kgDOLF55BQ"
    category={giscusCategory}
    categoryid={giscusCategoryId}
    mapping="url"
    strict="0"
    reactionsenabled="1"
    emitmetadata="0"
    inputposition="top"
    theme="light_protanopia"
    lang={locale}
    loading="eager"
    crossorigin="anonymous"
    async
    term={(() => {
      // URLì—ì„œ locale ê²½ë¡œì™€ .mdx í™•ì¥ì ì œê±°
      const currentPath = Astro.url.pathname;
      const cleanPath = currentPath
        .replace(/\.mdx\/?/g, '/')
        .replace(/^\/(en|ko)/, '');
      return cleanPath;
    })()}
    >
  </giscus-widget>
<!-- )} -->

<!-- {isDev && (
  <div class="p-4 border-2 border-dashed border-gray-300 rounded-lg text-center text-gray-500">
    <p>ğŸ’¬ ëŒ“ê¸€ ê¸°ëŠ¥</p>
    <p class="text-sm">ê°œë°œ í™˜ê²½ì—ì„œëŠ” ëŒ“ê¸€ì´ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
    <p class="text-xs">ë°°í¬ í›„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
  </div>
)} -->

<script>
  import 'giscus'
  
  // URL ì •ê·œí™” (ê°œë°œ ë° í”„ë¡œë•ì…˜ í™˜ê²½ ëª¨ë‘)
  const normalizeURL = () => {
    const originalURL = window.location.href;
    const cleanURL = originalURL
      .replace(/\.mdx\/?/g, '/')
      .replace(/\/(en|ko)\//g, '/');
    
    if (originalURL !== cleanURL) {
      // URLì„ ì •ê·œí™”ëœ ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸
      window.history.replaceState({}, '', cleanURL);
      return cleanURL;
    }
    return originalURL;
  };

  // í˜ì´ì§€ ë¡œë“œ ì‹œ URL ì •ê·œí™”
  normalizeURL();
</script>